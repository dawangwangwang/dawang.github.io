<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="向来拿不起,也放不下。QQ:1807801293">
    

    <!--Author-->
    
        <meta name="author" content="Yogurt">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="代码执行"/>
    

    <!--Open Graph Description-->
    
        <meta property="og:description" content="向来拿不起,也放不下。QQ:1807801293" />
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="Yogurt"/>

    <!--Type page-->
    
        <meta property="og:type" content="article" />
    

    <!--Page Cover-->
    

    <meta name="twitter:card" content="summary" />
    

    <!-- Title -->
    
    <title>代码执行 - Yogurt</title>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Google Analytics -->
    


</head>


<body>

<div class="bg-gradient"></div>
<div class="bg-pattern"></div>

<!-- Menu -->
<!--Menu Links and Overlay-->
<div class="menu-bg">
    <div class="menu-container">
        <ul>
            
            <li class="menu-item">
                <a href="/">
                    Home
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/archives">
                    Archives
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/about.html">
                    About
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/tags">
                    Tags
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/categories">
                    Categories
                </a>
            </li>
            
        </ul>
    </div>
</div>

<!--Hamburger Icon-->
<nav>
    <a href="#menu"></a>
</nav>

<div class="container">

    <!-- Main Content -->
    <div class="row">
    <div class="col-sm-12">

        <!--Title and Logo-->
        <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=990 height=86 src="//music.163.com/outchain/player?type=2&id=1299711624&auto=1&height=66"></iframe>
<header>
    <div class="logo">
        <a href="/"><i class="logo-icon fa fa-cube" aria-hidden="true"></i></a>
        
    </div>
</header>

        <section class="main">
            
<div class="post">

    <div class="post-header">
        <h1 class="title">
            <a href="/2018/11/21/代码执行/">
                代码执行
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2018-11-21</span>
            
            
                <a href="#disqus_thread" class="comments">Comments</a>
            
            
                <span class="category">
                    <a href="/categories/web/">web</a>
                </span>
            
        </div>
    </div>

    <div class="content">

        <!-- Gallery -->
        

        <!-- Post Content -->
        <h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>当应用在调用一些能将字符串转化成代码的函数时(如PHP中的eval、assert)，没有考虑到用户是否能控制这个字符串，所以可能会造成执行漏洞。狭义的代码注入通常指将可执行代码注入到当前页面中，如php的eval函数，可以将字符串代表的代码作为php代码执行，当前用户能够控制这段字符串时，将产生代码注入漏洞（也称命令执行）。广义上的代码注入，可以覆盖大半安全漏洞的分类。</p>
<h1 id="漏洞危害"><a href="#漏洞危害" class="headerlink" title="漏洞危害"></a>漏洞危害</h1><p>执行任意代码<br>写入webshell<br>甚至控制服务器<br>……</p>
<h1 id="常见代码执行的方式"><a href="#常见代码执行的方式" class="headerlink" title="常见代码执行的方式"></a>常见代码执行的方式</h1><ul>
<li>${}执行代码</li>
<li>eval()</li>
<li>assert()</li>
<li>preg_replace()</li>
<li>create_function()</li>
<li>array_map()</li>
<li>call_user_func()/call_user_func_array()</li>
<li>array_filter()</li>
<li>usort(),uasort()</li>
</ul>
<a id="more"></a>
<h1 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h1><h2 id="执行代码"><a href="#执行代码" class="headerlink" title="${}执行代码"></a>${}执行代码</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$&#123;phpinfo()&#125;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<h2 id="eval"><a href="#eval" class="headerlink" title="eval()"></a>eval()</h2><p>将字符串当成代码来执行。(合法的php代码)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">eval(&apos;echo 2;&apos;);</span><br><span class="line">eval($_GET[&apos;a&apos;]);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<h2 id="assert"><a href="#assert" class="headerlink" title="assert()"></a>assert()</h2><p>判断一个表达式是否成立。返回true or false。当参数为字符串时，会被当作php代码执行。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//a=phpinfo()</span><br><span class="line">&lt;?</span><br><span class="line">php assert($_POST[&apos;a&apos;]);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<h3 id="assert-函数支持动态调用"><a href="#assert-函数支持动态调用" class="headerlink" title="assert 函数支持动态调用"></a>assert 函数支持动态调用</h3><p>php官方在 php7中更改了 assert函数。在 php7.0.29之后的版本不支持动态调用。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//?a=phpinfo() </span><br><span class="line">&lt;?php </span><br><span class="line">$a = &apos;assert&apos;; </span><br><span class="line">$a($_POST[&apos;a&apos;]);</span><br><span class="line"> ?&gt;</span><br></pre></td></tr></table></figure></p>
<p> assert与eval的区别:assert把整个字符串参数当php代码执行，eval把合法的php代码执行。</p>
<h2 id="preg-replace"><a href="#preg-replace" class="headerlink" title="preg_replace()"></a>preg_replace()</h2><p> 执行一个正则表达式的搜索和替换<br>执行代码需要使用/e 修饰符。如果不使用/e 修饰符，代码则不会执行。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$a = &apos;phpinfo()&apos;;</span><br><span class="line">$b = preg_replace(&quot;/abc/e&quot;,$a,&apos;abcd&apos;);</span><br><span class="line">?&gt;//将abcd里的abc换成$b,故而代码得以执行</span><br></pre></td></tr></table></figure></p>
<h2 id="create-function"><a href="#create-function" class="headerlink" title="create_function()"></a>create_function()</h2><p>该函数用来创建匿名函数</p>
<h3 id="函数实现："><a href="#函数实现：" class="headerlink" title="函数实现："></a>函数实现：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$b = create_function(&apos;$name&apos;,&apos;echo $name;&apos;);</span><br><span class="line">$b(wang);//页面输出wang</span><br><span class="line">function niming($name)&#123;</span><br><span class="line">echo $name;</span><br><span class="line">&#125;</span><br><span class="line">niming(&apos;wang&apos;);//页面同样输出wang</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<h4>可以看到两种方法实现的效果一样。<br>一般来说 第二个参数就是代码执行的地方，将payload放在第二个参数，再调用该函数就可以执行payload啦。</h4>

<h3 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h3><h4 id="one"><a href="#one" class="headerlink" title="one:"></a>one:</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">$a = &apos;phpinfo();&apos;; </span><br><span class="line">$b = create_function(&quot; &quot;,$a); </span><br><span class="line">$b(); </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<h4 id="two"><a href="#two" class="headerlink" title="two:"></a>two:</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$id = $_GET[&apos;id&apos;];</span><br><span class="line">$zhixing = &apos;echo $name&apos;.&apos;的家乡是&apos;.$id.&apos;;&apos;;</span><br><span class="line">$b = create_function(&apos;$name&apos;,$zhixing);</span><br><span class="line">//实现</span><br><span class="line">function niming($name)&#123;</span><br><span class="line">    echo $name.&quot;的家乡是&quot;.$id;</span><br><span class="line">&#125;</span><br><span class="line">$b(&apos;dawang&apos;);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<h4>要注意的是这里直接get过去一个phpinfo()并无法实现，payload应该这样：</h4>

<h5 id="one-1"><a href="#one-1" class="headerlink" title="one"></a>one</h5><p></p><h3>?id=2;}phpinfo();/*  </h3><br>}与函数里的{闭合，;结束这段输出，后边phpinfo();执行，并把后边代码注释掉了，如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">function niming($name)&#123;    </span><br><span class="line">echo $name.编号 2;          </span><br><span class="line">&#125;phpinfo();/*     </span><br><span class="line">&#125; </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p></p>
<h5 id="two-1"><a href="#two-1" class="headerlink" title="two"></a>two</h5><p></p><h3>?id=2|phpinfo(); </h3> 该方法用到了管道符|，管道符使前边的2失效，执行管道符后边的.<p></p>
<h2 id="array-map-callable-callback-array-array1-array-…"><a href="#array-map-callable-callback-array-array1-array-…" class="headerlink" title="array_map ( callable $callback , array $array1 [, array $… ] )"></a>array_map ( callable $callback , array $array1 [, array $… ] )</h2><p>函数将用户自定义函数作用到数组(array1）中的每个值上，并返回用户自定义函数作用后的带有新值的数组。</p><br><p>回调函数接受的参数数目应该和传递给 array_map() 函数的数组数目一致（一个函数对应一组数组，俩函数就对应两组数组……）</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line"> //?a=assert&amp;b=phpinfo(); </span><br><span class="line">$a = $_GET[&apos;a&apos;]; </span><br><span class="line">$b = $_GET[&apos;b&apos;]; </span><br><span class="line">$array[0] = $b; </span><br><span class="line">$c = array_map($a,$array); </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<h2 id="call-user-func-call-user-func-array"><a href="#call-user-func-call-user-func-array" class="headerlink" title="call_user_func()/call_user_func_array()"></a>call_user_func()/call_user_func_array()</h2><h3 id="call-user-func-callable-callback-mixed-parameter-mixed-…"><a href="#call-user-func-callable-callback-mixed-parameter-mixed-…" class="headerlink" title="call_user_func ( callable $callback [, mixed $parameter [, mixed $… ]] )"></a><h2>call_user_func ( callable $callback [, mixed $parameter [, mixed $… ]] )</h2></h3><p>第一个参数 callback 是被调用的回调函数，其余参数是回调函数的参数。调用一个回调函数处理<code>字符串</code><br>传递的第一个参数必须为函数名，或者匿名函数，或者类的方法。<br>用有名函数时，只需传函数的名称。<br>用类的方法时，要传类的名称和方法名</p>
<h4 id="传递函数名："><a href="#传递函数名：" class="headerlink" title="传递函数名："></a>传递函数名：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">// ?a=phpinfo(); </span><br><span class="line">call_user_func(assert,$_GET[&apos;a&apos;]); </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<h4 id="调用匿名函数传参："><a href="#调用匿名函数传参：" class="headerlink" title="调用匿名函数传参："></a>调用匿名函数传参：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">//先增加后引用</span><br><span class="line">call_user_func(function($call)&#123;</span><br><span class="line">    echo ++$call,&apos;&lt;br/&gt;&apos;;</span><br><span class="line">    echo ++$call,&apos;&lt;br/&gt;&apos;;</span><br><span class="line">&#125;,1);//传给匿名函数的参数为···1···，执行的结果为2,3</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<h4 id="通过类名、对象的方式回调"><a href="#通过类名、对象的方式回调" class="headerlink" title="通过类名、对象的方式回调:"></a>通过类名、对象的方式回调:</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">/*</span><br><span class="line">  用call_user_func()来调用一个类里面的方法</span><br><span class="line"> */</span><br><span class="line"> </span><br><span class="line">class myclass&#123;</span><br><span class="line">	static function hello()&#123;</span><br><span class="line">		echo &quot;Da wang!\n&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">$classname = &quot;myclass&quot;;</span><br><span class="line">//通过数组键值的方式，对类名进行回调，回调类名里面的，hello方法</span><br><span class="line">call_user_func(array($classname,&apos;hello&apos;));</span><br><span class="line"> </span><br><span class="line">//通过类名直接调用静态方法</span><br><span class="line">call_user_func($classname .&apos;::hello&apos;); </span><br><span class="line"> </span><br><span class="line">//通过对象的方式回调</span><br><span class="line">$myobject = new myclass();</span><br><span class="line">call_user_func(array($myobject, &apos;hello&apos;));</span><br><span class="line"> </span><br><span class="line"> ?&gt;</span><br></pre></td></tr></table></figure>
<h3 id="call-user-func-array-callable-callback-array-param-arr"><a href="#call-user-func-array-callable-callback-array-param-arr" class="headerlink" title="call_user_func_array ( callable $callback , array $param_arr )"></a>call_user_func_array ( callable $callback , array $param_arr )</h3><p></p><p>把第一个参数作为回调函数（callback）调用，把参数数组作（param_arr）为回调函数的的参数传入。利用回调函数处理数组</p><br>函数的调用和作用和call_user_func函数基本一样，不同的是，call_user_func_array函数只能传递两个参数，第一个是回调函数名，或者匿名函数，或者类方法，第二个参数则是数组，从这里也可以看出，其实call_user_func_array函数与call_user_func不同的是，call_user_func_array是利用回调函数处理数组，而call_user_func则是利用回调函数处理字符串，他们两个的根本差别就在这里。<p></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line"> //?a=phpinfo(); $array[0] = $_GET[&apos;a&apos;]; </span><br><span class="line"> call_user_func_array(&quot;assert&quot;,$array); </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<h2 id="array-filter"><a href="#array-filter" class="headerlink" title="array_filter()"></a>array_filter()</h2><p>用回调函数过滤数组中的元素<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php  </span><br><span class="line">$array[0] = $_GET[&apos;a&apos;]; </span><br><span class="line">array_filter($array,&apos;assert&apos;); </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<h2 id="usort"><a href="#usort" class="headerlink" title="usort()"></a>usort()</h2><p>使用用户自定义的比较函数对数组中的值进行排序,如果要排序的数组需要用一种不寻常的标准进行排序，那么应该使用此函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php // ?1[]=test&amp;1[]=phpinfo();&amp;2=assert </span><br><span class="line">usort(...$_GET); </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>只有在 php5.6 以上环境才可使用<br>详细解释 <a href="https://www.leavesongs.com/PHP/bypass-eval-length-restrict.html" target="_blank" rel="noopener">https://www.leavesongs.com/PHP/bypass-eval-length-restrict.html</a><br>然后…$_GET 是 php5.6 引入的新特性。将数组展开成参数的形式。</p>
<p></p><h6>下面这种写法只在 php5.6 版本以下可以使用。 </h6><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">// ?1=1+1&amp;2=phpinfo(); </span><br><span class="line">usort($_GET,&apos;asse&apos;.&apos;rt&apos;);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p></p>
<h2 id="uasort"><a href="#uasort" class="headerlink" title="uasort()"></a>uasort()</h2><p>使用用户自定义的比较函数对数组中的值进行排序并保持索引关联</p>
<h1 id="修复方案"><a href="#修复方案" class="headerlink" title="修复方案"></a>修复方案</h1><p>对于eval()函数，一定要保证用户不能轻易接触eval的参数，如果接触一定要使用单引号包裹可控代码，并在插入前进行addslashes.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$data = addslashes($data);</span><br><span class="line">eval(&quot;$data = deal(&apos;$data&apos;)&quot;);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>对于preg_replace()函数，要放弃使用/e修饰符，也可以使用preg_replace_callback()函数代替。如果一定要使用该函数，请保证第二个参数中，对于正则匹配出的对象用单引号包裹。</p>
<h1 id="真题测试"><a href="#真题测试" class="headerlink" title="真题测试"></a>真题测试</h1><p>这是学长根据lctf改的一道题，做了做，当时思路是对的，只不过没有用对函数哈哈哈。</p>
<p>话不多说 ，上题。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">$b = &apos;implode&apos;;</span><br><span class="line">call_user_func($_GET[f],$_POST);</span><br><span class="line">session_start();</span><br><span class="line">if(isset($_GET[name]))&#123;</span><br><span class="line">    $_SESSION[name] = $_GET[name];</span><br><span class="line">&#125;</span><br><span class="line">var_dump($_SESSION);</span><br><span class="line">$a = reset($_SESSION),&apos;welcome_to_the_lctf2018&apos;;</span><br><span class="line">call_user_func($b,$a);</span><br><span class="line">?&gt;</span><br><span class="line">array(0) &#123; &#125;</span><br></pre></td></tr></table></figure></p>
<p>审完代码 发现有几个函数不熟，于是百度了解一下。</p>
<p>我们可以控制的变量有$f ,$name,还可以post过去一个值。看到$b=’implode’了之后，就晓得该post过去什么了~嘿嘿那就是post过去一个新的$b，覆盖掉旧的$b。</p>
<p>再根据call_user_func函数的特性，$b应该是一个函数，$a应是我们想执行的代码。</p>
<p>好了好了不墨迹了，上手。</p>
<p><img src="/2018/11/21/代码执行/1.png" alt=""></p>
<p>解密，得flag。</p>
<p>ps:</p>
<p>extract函数使post过去的b=assert 成为$b=assert<br>assert函数 执行system</p>

    </div>

    

    
        <div class="post-tags">
            <i class="fa fa-tags" aria-hidden="true"></i>
            <a href="/tags/PHP/">#PHP</a>
        </div>
    

    <!-- Comments -->
    
    <div class="comments">
        
<div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>



    </div>
    

</div>
        </section>

    </div>
</div>


</div>

<!-- Footer -->
<div class="push"></div>

<footer class="footer-content">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 footer-about">
                <h2>About</h2>
                <p>
                    希望每个人都能找到自己的不可替代。
                </p>
            </div>
            
    <div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 recent-posts">
        <h2>Recent Posts</h2>
        <ul>
            
            <li>
                <a class="footer-post" href="/2019/05/27/ISCC2019/">ISCC2019（线上赛5月）</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2019/05/24/Django-debug-page-XSS漏洞-CVE-2017-12794-分析/">Django debug page XSS漏洞(C</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2019/05/15/缓存中间件/">缓存中间件</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2019/05/10/中间件漏洞/">中间件漏洞</a>
            </li>
            
        </ul>
    </div>



            
<div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 footer-categories">
    <h2>Categories</h2>
    <ul>
        
        <li>
            <a class="footer-post" href="/categories/报错/">报错</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/CTF环境搭建/">CTF环境搭建</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/漏洞分析/">漏洞分析</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/docker/">docker</a>
        </li>
        
    </ul>
</div>

        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <ul class="list-inline footer-social-icons">
                    
                    <li class="list-inline-item">
                        <a href="https://github.com/klugjo/hexo-theme-alpha-dust">
                            <span class="footer-icon-container">
                                <i class="fa fa-github"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    
                    
                    
                    <li class="list-inline-item">
                        <a href="https://plus.google.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-google-plus"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    
                    <li class="list-inline-item">
                        <a href="mailto:1807801293@qq.com">
                            <span class="footer-icon-container">
                                <i class="fa fa-envelope-o"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="footer-copyright">
                    This is Yogurt
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- After footer scripts -->

<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Tween Max -->
<script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.5/TweenMax.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Custom JavaScript -->
<script src="/js/main.js"></script>

<!-- Disqus Comments -->

<script type="text/javascript">
    var disqus_shortname = 'klugjotest';

    (function(){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/"});</script></body>

</html>